# AI News Digest Bot

Этот проект представляет собой автоматизированную систему для сбора, анализа и публикации еженедельного дайджеста новостей. Архитектура проекта позволяет запускать несколько независимых ботов из одной кодовой базы, каждый со своей конфигурацией, тематикой и базой данных.

## Архитектура

Приложение состоит из следующих модулей:

1.  **`telegram_parser.py`**: Собирает посты из Telegram-каналов, указанных в конфигурации, с помощью **Telethon**.
2.  **`database.py`**: Хранит собранные посты в **SQLite** базе данных. Имя файла базы данных задается в конфигурации.
3.  **`article_generator.py`**: Использует **OpenAI API** для анализа постов и генерации уникального лонг-рида и краткого содержания на основе кастомного промпта из конфигурации.
4.  **`telegraph_publisher.py`**: Публикует сгенерированную статью на платформе **Telegra.ph**.
5.  **`telegram_notifier.py`**: Отправляет уведомление со ссылкой на статью в заданный Telegram-чат.
6.  **`main.py`**: Главный файл, который запускает весь процесс по расписанию с помощью **APScheduler**. Принимает аргумент командной строки `--config` для выбора файла конфигурации.
7.  **`config.py`**: Модуль для загрузки и управления конфигурацией из `.env` файлов.

## Установка и запуск

### 1. Клонируйте репозиторий
```bash
git clone <your-repo-url>
cd ai_news_digest
```

### 2. Создайте и активируйте виртуальное окружение
```bash
python3 -m venv venv
source venv/bin/activate
```

### 3. Установите зависимости
```bash
pip install -r requirements.txt
```

### 4. Настройте конфигурацию

Система использует `.env` файлы для конфигурации каждого бота. Вы можете создать несколько таких файлов для запуска разных инстансов.

1.  **Создайте файлы конфигурации.** Например, для AI-бота и HR-бота:
    ```bash
    cp .env.example .env.ai
    cp .env.example .env.hr
    ```

2.  **Заполните переменные** в каждом файле (`.env.ai`, `.env.hr` и т.д.):
    *   `API_ID`, `API_HASH`: Ваши учетные данные из [my.telegram.org](https://my.telegram.org).
    *   `BOT_TOKEN`: Токен Telegram-бота от [@BotFather](https://t.me/BotFather).
    *   `CHAT_ID`: ID целевого Telegram-канала или чата (например, `@my_channel`).
    *   `OPENAI_API_KEY`: Ваш ключ от OpenAI.
    *   `TELEGRAM_CHANNELS`: Список каналов для парсинга, через запятую (например, `channel1,channel2`).
    *   `DB_NAME`: Имя файла для базы данных SQLite (например, `ai_news.db`). **Должно быть уникальным для каждого бота.**
    *   `ARTICLE_PROMPT`: Системный промпт для OpenAI, определяющий стиль и структуру генерируемой статьи.

### 5. Первый запуск (для авторизации Telethon)

При первом запуске Telethon попросит вас авторизоваться. Это нужно сделать для каждого инстанса, который использует новый номер телефона.

*   Запустите парсер вручную, указав нужный конфиг:
    ```bash
    # Пример для AI-бота
    python -c "from src import config, telegram_parser; import asyncio; config.load_config('.env.ai'); asyncio.run(telegram_parser.parse_channels())"
    ```
*   Введите номер телефона и код из Telegram. Будет создан файл сессии (`.session`).

### 6. Запуск бота

Вы можете запустить любого из настроенных ботов, указав его файл конфигурации.

```bash
# Запустить AI-бота
python main.py --config .env.ai

# Запустить HR-бота в другом терминале
python main.py --config .env.hr
```

## Развертывание на сервере (Production)

Для постоянной работы рекомендуется использовать `systemd`.

1.  Создайте сервис-файл (например, `/etc/systemd/system/ai_bot.service`).
2.  Укажите в нем полный путь к `main.py` и нужный флаг `--config`.
3.  Запустите и добавьте в автозагрузку с помощью `systemctl`.

Пример сервис-файла и подробные инструкции можно найти в диалоге с ассистентом, который помогал с настройкой.